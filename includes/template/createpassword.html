%%DEFINE_HEADER%%
<section>
<div class="new_signin_bg">
	<div class="row flex-column-reverse flex-md-row">
    	<div class="col-xl-8 col-lg-8 col-12">
        	<div class="signin_left_bg video">
            	<video width="100%" border="0" autoplay muted loop>
                    <source src="%%DEFINE_IMAGE_LINK%%/images/video/esign-signin-page.mp4" type="video/mp4">
                </video>
            </div>
        </div>
        <div class="col-xl-4 col-lg-4 col-12">
			<div class="signin_right">
				<form id="createpasswordform" method="post" >
					<div class="row">
						<div class="col-md-12 col-12">
							<div class="alert alert-danger" id="passwordError" style="display: none;"></div>
							<div id="snackbar" class="fixed top-0 right-0 p-3"></div>
							<div id="snackbar-error" class="fixed top-0 right-0 p-3"></div>
							<div id="snackbar-info" class="fixed top-0 right-0 p-3"></div>
							<div class="top_logo"><img src="https://betaapp.customesignature.com/images/logo.svg" alt=""></div>
							%%DEFINE_Message%%
							<h5 class="text-2xl text-center font-normal">Create Password</h5>
							<div class="mt-3">
								<input type="password" class="form-control" id="suser_password" name="suser_password" id="suser_password" placeholder="Password" required="required">
								
							</div>
							<div class="mt-3">
								<input type="password" class="form-control" id="suser_confirm_password" name="suser_confirm_password" id="suser_confirm_password" placeholder="Confirm Password" required="required">
							</div>
							
							<div class="sign_in_button">
								<button type="submit" name="submit" class="btn btn-primary passwordSubmit">Submit</button>
							</div> 	
						</div>
					
					</div>
					<input type="hidden" id="form_url" value="%%DEFINE_usermanagement%%/savepassword" />
					<input type="hidden" id="suser_email" name="suser_email" value="%%DEFINE_suser_email%%" />
					<input type="hidden" id="redirecturld" value="%%DEFINE_linkModuleDashboard%%" />
				</form>
            </div>
        </div>
    </div>
</div>
 

<script src="%%DEFINE_ROOT_LINK%%/script/jquery-3.5.1.min.js"></script> 

<script language="javascript">
	$(document).ready(function(){
		$('#createpasswordform').on('submit', function (e) {
			var redirecturld = $('#redirecturld').val();
			var validate =1;

			if($('#suser_password').val() === ""){
				$('#suser_password').css('border-bottom-color','#842029'); validate =0;
			}
			if($('#suser_confirm_password').val() === ""){
				$('#suser_confirm_password').css('border-bottom-color','#842029'); validate =0;
			}

			var password = $('#suser_password').val();
			var confirmPassword = $('#suser_confirm_password').val();
			var errorMessage = '';

			// Check password length (at least 8 characters)
			if (password.length < 8) {
				errorMessage += 'Password must be at least 8 characters long. ';
			}
			else if (!/[a-z]/.test(password)) {
				errorMessage += 'Password must contain at least one lowercase letter. ';
			}
			else if (!/[A-Z]/.test(password)) {
				errorMessage += 'Password must contain at least one uppercase letter. ';
			}
			else if (!/[0-9]/.test(password)) {
				errorMessage += 'Password must contain at least one number. ';
			}
			else if (!/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
				errorMessage += 'Password must contain at least one special character. ';
			}
			else if (password !== confirmPassword) {
				errorMessage += 'Passwords do not match. ';
			}
			if (errorMessage) {
				$('#passwordError').html('<strong>Fail!</strong>'+errorMessage);
				$("#passwordError").show();
				setTimeout(function(){ $('#passwordError').hide(); }, 2000);
				validate =0;
			}

			
			if(validate != 1){
				event.stopPropagation(); return false;
			}
			var form = $('#createpasswordform');
			data = form.serialize();
			formUrl = $('#form_url').val();
			$.ajax({
				type: 'POST',
				url: formUrl,
				data: form.serialize()
			}).done(function(data) {
				var json = JSON.parse(data);
				if(json.error != 1){
					$('#snackbar').html('<div class="gap-8 py-5 px-4 pl-11 border-l-9 border-green-600 rounded-xl relative bg-white bg-gradient-to-r from-[#00B71B]/12 to-[#00B71B]/0 shadow-lg"><img draggable="false" class="absolute left-4" src="%%DEFINE_IMAGE_LINK%%/images/success-message-icon.svg" alt=""><strong>Success! </strong>Password saved! </div>');
					$('#snackbar').show();
					setTimeout(function(){ $('#snackbar').hide(); window.location = redirecturld; }, 2000);
				}else{
					$('#snackbar-error').html('<div class="alert alert-danger"><img draggable="false" class="absolute left-4" src="%%DEFINE_IMAGE_LINK%%/images/error-message-icon.svg" alt=""><strong>Failure! </strong>'+json.msg+' </div>');
					$('#snackbar-error').show();
					setTimeout(function(){ $('#snackbar-error').hide(); }, 2000);
					return false;
				}
				// Optionally alert the user of success here...
			}).fail(function(data) {
			return false;
				// Optionally alert the user of an error here...
			});
		return false;
		});
		
	});
</script>
</section>
%%DEFINE_FOOTER%%