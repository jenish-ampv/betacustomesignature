%%DEFINE_HEADER%%

<section class="upload_brand-logo-page">
  <div id="snackbar" class="success-error-message fixed top-0 right-0 p-3"></div>
  <div id="snackbar-error" class="success-error-message fixed top-0 right-0 p-3"></div>
  <div id="snackbar-info" class="success-error-message fixed top-0 right-0 p-3"></div>

  <div class="new_signin_bg" id="logoContainer">
 	  <div class="row">
        <div class="col-xl-4 col-lg-4 col-12">
          <div class="signin_left_bg video">
            <video width="100%" autoplay="" muted="" loop="">
                  <source src="%%DEFINE_IMAGE_LINK%%/images/video/esign-signin-page.mp4" type="video/mp4">
              </video>
          </div>
        </div>
        <div class="col-xl-8 col-lg-8 col-12">
        	<form id="logoform">
            <fieldset>
              <div class="upload_brand_logo_main">
                <div class="top_logo"><img draggable="false" src="%%DEFINE_IMAGE_LINK%%/images/logo.svg" alt=""></div>
                <div class="row">
                  <div class="col-xl-12 col-md-12 col-12">
                    <div class="upload_logo_inner">
                      <h3>Upload Brand Logo</h3>
                      <!-- <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt.</p> -->
                      <input type="file" name="logofile" id="logofile" style="display:none;">
                      <div class="upload-area-logo" id="uploadlogofile">
                        <div class="drag_your_image"> 
                          <h4>Drag your image here, or <a href="javascript:void(0);">browse</a></h4>
                          <p>Supports: PNG, SVG</p>
                          <img draggable="false" src="%%DEFINE_IMAGE_LINK%%/images/img-icon.svg" alt="">
                        </div>
                      </div>
                      <p class="note"><b>Note:</b> Please upload a logo with dimensions <b>500Ã—500 and above pixels</b> for better animation quality.</p>
                      <div id="img_preview"></div>
                      <div id="img_errormsg"></div>

                      <input type="hidden" value="%%DEFINE_USERUPLOADLIMIT%%" id="uploadlimit" />
                      <div class="button">
                        <button type="button" name="next" class="btn submit action-button" value="Next Step" id="nxt2" data-id="1">Submit</button>
                      </div>
                  </div>
                  </div>
                </div>
            
              </div>
            </fieldset>
          </form>
        </div>
    </div>
  </div>
   
  
  <input type="hidden" id="upload_url" value="%%DEFINE_uploadbrandlogo%%/uploadlogo" />
  <input type="hidden" id="redirecturld" value="%%DEFINE_linkModuleDashboard%%" />
  <input type="hidden" id="form_url" value="%%DEFINE_uploadbrandlogo%%/savelogo" />

</section>
<!-- Form-->
<script src="%%DEFINE_JS_LINK%%/jquery-3.5.1.min.js"></script> 
<script src="%%DEFINE_JS_LINK%%/uploadimage.js?v=%%DEFINE_CSS_VERSION%%" type="text/javascript"></script>
<script src="%%DEFINE_JS_LINK%%/uploadsigprofile.js?v=%%DEFINE_CSS_VERSION%%" type="text/javascript"></script>
<!-- <script src="%%DEFINE_JS_LINK%%/uploadprofileimagefirsttime.js?v=%%DEFINE_CSS_VERSION%%" type="text/javascript"></script> --> <!-- Js for first time profile upload for new user  -->
<script src="%%DEFINE_JS_LINK%%/uploadbanner.js?v=%%DEFINE_CSS_VERSION%%" type="text/javascript"></script>
<script src="%%DEFINE_JS_LINK%%/sigeditor.js?v=%%DEFINE_CSS_VERSION%%" type="text/javascript"></script>

<link href="%%DEFINE_JS_LINK%%/nouislider/nouislider.min.css" rel="stylesheet">
<script src="%%DEFINE_JS_LINK%%/nouislider/nouislider.min.js"></script>
<script type="text/javascript">
jQuery.noConflict();
(function($) {
$(document).ready(function(){

  var ui = jQuery.noConflict();
  var image_link = ui('#image_link').val();
  var upload_signature_logourl = ui('#upload_url').val();
  ui(function() {

    // preventing page from redirecting
    ui("html").on("dragover", function(e) {
        e.preventDefault();
        e.stopPropagation();
        // ui("h1").text("Drag here");
    });

    ui("html").on("drop", function(e) { e.preventDefault(); e.stopPropagation(); });

    // Drag enter
    ui('.upload-area-logo').on('dragenter', function (e) {
        e.stopPropagation();
        e.preventDefault();
        // ui("h1").text("Drop");
    });

    // Drag over
    ui('.upload-area-logo').on('dragover', function (e) {
        e.stopPropagation();
        e.preventDefault();
        // ui("h1").text("Drop");
    });

    // Drop
    ui('.upload-area-logo').on('drop', function (e) {
        e.stopPropagation();
        e.preventDefault();

        // ui("h1").text("Upload");

        var file = e.originalEvent.dataTransfer.files;
        var fd = new FormData();

        fd.append('file', file[0]);

        uploadLogoData(fd);
    });

    // Open file selector on div click
    ui("#uploadlogofile").click(function(){
        ui("#logofile").click();
    });

    // file selected
    ui("#logofile").change(function(){
      var fd = new FormData();

      var files = ui('#logofile')[0].files[0];

      fd.append('file',files);
      ui("#img_preview").html('<div class="img_preview_box"><div class="d-flex align-items-center"><strong>Uploading...</strong><div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>');

      uploadLogoData(fd);
    });
  
    // remove image;

  });

  // Sending AJAX request and upload file
  function uploadLogoData(formdata){
      var department_id = getUrlParameter('department_id');

      if(department_id){
          ui.ajax({
              url: upload_url+'?department_id='+department_id,
              type: 'post',
              data: formdata,
              contentType: false,
              processData: false,
              dataType: 'json',
              success: function(response){
                  addLogoThumbnail(response);
              }
          });
      }
      else{
          ui.ajax({
              url: upload_url,
              type: 'post',
              data: formdata,
              contentType: false,
              processData: false,
              dataType: 'json',
              success: function(response){
                  addLogoThumbnail(response);
              }
          });
      }
  }

  // Added thumbnail
  function addLogoThumbnail(data){
    if(data.error == 0){
      ui("#uploadlogofile").empty();
      ui("#img_preview").empty();
      var len = ui("#uploadlogofile div.thumbnail").length;
    
      var num = Number(len);
      num = num + 1;
    
      var name = data.name;
      var displayname = data.displayname;
      var size = convertSize(data.size);
      var src = data.src;
      var number = Math.random() * 100;
      // Creating an thumbnail
       // ui("#uploadfile").append('<div id="thumbnail_'+num+'" class="thumbnail"></div>');
      ui("#uploadlogofile").append('<div class="drag_your_image"> <img src="'+src+'?rand='+number+'" width="50%"></div>');
      ui("#img_preview").append( `<div class="flex items-center p-5 gap-2 rounded-lg bg-gray-200 my-3"><img src="${image_link}/images/applied-icon.png" alt=""> ${displayname} &nbsp; (${size}) <a class="ml-auto text-base" href="javascript:void(0);" onclick="removeLogoImage()"><i class="hgi hgi-stroke hgi-delete-02 text-danger"></i></a><input type="hidden" name="signature_image" value="${name}"></div>`);
          ui('input[name=signature_image]').val(name);
      ui("#nxt2").prop('disabled', false);
          ui('.layout_logo').attr("src",src+'?rand='+number);
      ui("#img_errormsg").html('');
    }else{
      ui("#img_errormsg").html('<div class="alert alert-danger" role="alert">'+data.msg+'</div>');
          setTimeout(function(){ ui("#img_preview").empty();ui("#img_errormsg").html('');}, 3000);
      
    }

  }


  window.removeLogoImage = function() {
    ui("#uploadlogofile").empty();
    ui("#img_preview").empty();
    ui("#uploadlogofile").append(`<div class="drag_your_image"> <h4>Drag your image here, or <a href="#">browse</a></h4><p>Supports: PNG, SVG</p><img src="${image_link}/images/img-icon.svg" alt=""></div>`);
  }

  $(".submit").click(function(){
    var redirecturl = $('#redirecturl').val();
    var redirecturld = $('#redirecturld').val();
    var fileInput = $('#logofile')[0]; // Get the DOM element
    if (fileInput.files.length === 0) {
      $('#snackbar-error').html(`<div class="alert alert-danger"><img draggable="false" class="absolute left-4" src="${image_link}/images/error-message-icon.svg" alt=""><strong>Failure! </strong>Please select file</div>`);
      $('#snackbar-error').show();
      setTimeout(function(){ $('#snackbar-error').hide(); }, 2000);
      return false;
    }
    $(".loader-image").show();
    var form = $('#logoform');
    data = form.serialize();
    formUrl = $('#form_url').val();

    $.ajax({
        type: 'POST',
        url: formUrl,
        data: form.serialize()
      }).done(function(data) {
        var json = JSON.parse(data);
        $(".loader-image").hide();
        if(json.error != 1){
          $('#snackbar').html(`<div class="success-error-message gap-8 py-5 px-4 pl-11 border-l-9 border-green-600 rounded-xl relative bg-white bg-gradient-to-r from-[#00B71B]/12 to-[#00B71B]/0 shadow-lg"><img draggable="false" class="absolute left-4" src="${image_link}/images/success-message-icon.svg" alt=""><strong>Success! </strong>Signature saved! </div>`);
  			  $('#snackbar').show();
  			  setTimeout(function(){ $('#snackbar').hide(); window.location = redirecturld; }, 2000);
          setTimeout(function(){ x.className = x.className.replace("show", ""); window.location = redirecturld; }, 2000);
        }else{
          $('#snackbar-error').html(`<div class="alert alert-danger"><img draggable="false" class="absolute left-4" src="${image_link}/images/error-message-icon.svg" alt=""><strong>Failure! </strong>${json.msg} </div>`);
          $('#snackbar-error').show();
          $("#img_preview").empty();
          setTimeout(function(){ $('#snackbar-error').hide(); window.location = redirecturld; }, 2000);
          return false;
        }
        // Optionally alert the user of success here...
      }).fail(function(data) {
      return false;
        // Optionally alert the user of an error here...
      });
  return false;
  });

  

});
})(jQuery);
</script>
<!--  Form End-->

%%DEFINE_FOOTER%%
